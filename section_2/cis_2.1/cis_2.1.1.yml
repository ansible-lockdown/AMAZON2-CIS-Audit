# CIS for Chrony
{{ if eq .Vars.amazon2cis_time_synchronization "chrony" }}
  {{ if .Vars.amazon2cis_level1 }}
    {{ if .Vars.amazon2cis_rule_2_1_1 }}
package:
  chrony:
    title: 2.1.1 | Ensure time synchronization is in use
    installed: true
    meta:
      server: 1
      workstation: NA
      CIS_ID:
      - 2.1.1
      CISv8:
      - 8.4
      CISv8_IG1: false
      CISv8_IG2: true
      CISv8_IG3: true
      NIST800-53R5:
      - AU-3
      - AU-12
service:
  chronyd:
    title: 2.1.2 | Ensure chrony is configured | running
    enabled: true
    running: true
    meta:
      server: 1
      workstation: NA
      CIS_ID:
      - 2.1.2
      CISv8:
      - 8.4
      CISv8_IG1: false
      CISv8_IG2: true
      CISv8_IG3: true
    {{ end }}
  {{ end }}
{{ end }}
## chrony settings
    {{ if .Vars.amazon2cis_rule_2_1_2 }}
file:
  chrony_conf:
    title: 2.1.2 | Ensure chrony is configured | chrony.conf
    path: /etc/chrony.conf
    exists: true
    contents:
    - '/^server/'
    skip: false
    meta:
      server: 1
      workstation: NA
      CIS_ID:
      - 2.1.2
      CISv8:
      - 8.4
      CISv8_IG1: false
      CISv8_IG2: true
      CISv8_IG3: true
      NIST800-53R5:
      - AU-3
      - AU-12
  sysconfig_chronyd:
    title: 2.1.3 | Ensure chrony is not run as the root user | sysconf
    path: /etc/sysconfig/chronyd
    exists: true
    contents:
    - 'OPTIONS="-u chrony"'
    skip: false
    meta:
      server: 1
      workstation: NA
      CIS_ID:
      - 2.1.3
      CISv8:
      - 8.4
      CISv8_IG1: false
      CISv8_IG2: true
      CISv8_IG3: true
      NIST800-53R5:
      - AU-3
      - AU-12
    {{ end }}
  {{ end }}
{{ end }}
